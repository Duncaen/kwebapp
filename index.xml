<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta charset="utf-8" /> 
		<title>kwebapp | web application source generator</title>
		<link rel="alternate" href="atom.xml" type="application/atom+xml" title="kwebapp version feed" />
		<link rel="stylesheet" href="highlight.css" />
		<link rel="stylesheet" href="index.css" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
		<link rel="stylesheet" href="https://code.cdn.mozilla.net/fonts/fira.css" />
	</head>
	<body lang="en" itemscope="itemscope" itemtype="http://schema.org/SoftwareApplication">
		<header>
			<section id="breadcrumbs">
				<div><div>&#160;</div></div>
				<div>
					<div>
						BSD.lv tools for BCHS: 
						<a href="https://kristaps.bsd.lv/kcgi">kcgi</a>, 
						<a href="https://kristaps.bsd.lv/ksql">ksql</a>, 
						<a href="https://kristaps.bsd.lv/kwebapp">kwebapp</a>
					</div>
				</div>
				<div><div>&#160;</div></div>
			</section>
			<section id="header">
				<div>
					<h1 itemprop="name">kwebapp</h1> 
					<span>&#8212; 
						<span itemprop="description">web application source generator</span> 
						<nav data-sblg-nav="1" data-sblg-navsort="date" data-sblg-navtag="version" data-sblg-navsz="1" data-sblg-navxml="1">
							${sblg-titletext}
						</nav>
					</span>
				</div>
				<nav>
					<a href="https://github.com/kristapsdz/kwebapp">github</a>
					<a href="kwebapp.1.html">kwebapp(1)</a>
					<a href="kwebapp.5.html">kwebapp(5)</a>
					<a href="snapshots/kwebapp.tar.gz">source</a>
					<a href="snapshots">archive</a>
					<a href="atom.xml"><i class="fa fa-rss"></i></a>
				</nav>
			</section>
		</header>
		<article>
			<section>
				<p>
					<span class="nm">kwebapp</span> is an <a href="https://opensource.org/licenses/ISC">open source</a> UNIX
					system generating front-end (JavaScript) and back-end (SQL, C) for your web application, leaving you to
					develop your business logic.
					It accepts a configuration file that describes your data: tables (structures), fields (members),
					accessors (search, list, iterate), modifiers (insert, update, delete), etc.
					Even <a href="https://learnbchs.org/rbac.html">role-based access control</a>.
					It generates the source files (C header, C source, SQL schema, SQL update schema, JavaScript) for your
					application.
				</p>
				<p>
					Yes, C&#8212;as in <a href="https://learnbchs.org">BCHS</a>.
				</p>
				<figure>
					<img src="index.svg" alt="" />
					<figcaption>
						Compilation sequence from <a href="kwebapp.5.html">kwebapp(5)</a> configuration to output.
					</figcaption>
				</figure>
				<p>
					The system has no run-time dependencies; however, the generated C files use <a
						href="https://kristaps.bsd.lv/ksql">ksql(3)</a> as a wrapper for the underlying <a
						href="https://sqlite.org">SQLite</a> database.
					If optionally generating JSON formatters for exporting data or validation routines for HTML form input,
					you will also require <a href="https://kristaps.bsd.lv/kcgi">kcgi(3)</a>.
					Generated JavaScript files are <q><a href="http://vanilla-js.com/">vanilla</a></q> and have no framework
					dependencies.
				</p>
				<p>
					<strong>You will need the newest version of this libraries.</strong>
					Sources output by <span class="nm">kwebapp</span> use features from the newest releases:
					all of these tools are being built in tandem.
				</p>
				<p>
					<span class="nm">kwebapp</span> is a <a href="https://www.bsd.lv">BSD.lv</a> project.
					For the time being, the C source output currently hardcodes OpenBSD-specific functions in its output
					(e.g., <a href="http://man.openbsd.org/crypt_newhash.3">crypt_newhash(3)</a> and so on).
					If you plan on using the system, please be aware of that!
					See the <a href="https://github.com/kristapsdz/kwebapp">GitHub repository</a> for issue tracking and
					versioning.
					To use <span class="nm">kwebapp</span>, just unpack, run <code>./configure</code>, <code>make</code>,
					then <code>make install</code>.
				</p>
				<nav data-sblg-nav="1" data-sblg-navsort="date" data-sblg-navtag="version" data-sblg-navsz="1" data-sblg-navcontent="1">
					<h3>
						Latest release: ${sblg-titletext}
					</h3>
					<time>
						<i class="fa fa-clock-o"></i> 
						${sblg-date}
					</time>
					<div>
						${sblg-aside}
					</div>
				</nav>
				<p class="archive">
					For previous releases, see the <a href="archive.html">version archive</a>.
				</p>
			</section>
			<blockquote>
				<h2>
					% <a href="kwebapp.1.html">kwebapp</a> <a href="db.txt.html">db.txt</a>
				</h2>
				<div>
					Parse and validate configuration.
				</div>
			</blockquote>
			<section>
				<p>
					Consider an example <a href="kwebapp.5.html">kwebapp(5)</a> configuration file, <a
						href="db.txt.html">db.txt</a>.
					It defines three data objects&#8212;a <code>user</code>, <code>company</code>, and
					<code>session</code>&#8212;with relations between the three.
					Each <code>session</code>, in this example, refers to a <code>user</code> by the
					<code>userid</code> field.
					Then each <code>user</code> refers to a <code>company</code> by its <code>cid</code>.
				</p>
				<p>
					The configuration is fairly readable: structures and fields, with field types and limits (string length
					or numeric value) and other options (nullity, whether a row identifier, etc.).
				</p>
				<p>
					The <a href="kwebapp.1.html">kwebapp(1)</a> utility parses and validates the configuration.
				</p>
				<article data-sblg-permlink="0" data-sblg-article="1"></article>
				<p>
					Beyond the data itself, each objects defines search, update, and deletion functions.
					(A normal application would have more, but for brevity&#8230;)
				</p>
				<p>
					To <em>do</em> something with this configuration, we need to have code.
					Most applications start by creating an API from the data configuration as described in the next section.
				</p>
			</section>
			<blockquote>
				<h2>
					<div>
						% <a href="kwebapp-c-header.1.html">kwebapp-c-header</a> -jv 
						<a href="db.txt.html">db.txt</a> &gt;<a href="db.h.html">db.h</a>
					</div>
					<div>
						% <a href="kwebapp-c-source.1.html">kwebapp-c-source</a> -jv 
						-h <a href="db.h.html">db.h</a> <a href="db.txt.html">db.txt</a> &gt;<a href="db.c.html">db.c</a>
					</div>
				</h2>
				<div>
					Output application's API and implementation.
				</div>
			</blockquote>
			<section>
				<p>
					This invocation will generate source files built to be part of a web application chain.  On a modern <a
						href="https://www.openbsd.org">OpenBSD</a> system, this may be linked to sources driving a <a
						href="https://kristaps.bsd.lv/kcgi">kcgi(3)</a> CGI script.
					Each function and structure in the header file is documented thoroughly.
					The source files are also documented (more sparsely) to guide developers in reading through the
					implementation.
				</p>
				<p>
					Note the <b>-static</b> in the following invocation, which is required for running CGI binaries within
					the default
					file-system jail on OpenBSD web servers (see <a href="http://man.openbsd.org/httpd.8">httpd(8)</a>,
					which I use as a reference web server).
				</p>
				<p>
					The required libraries are <b>-l</b><i>ksql</i> for the database routines,
					<b>-l</b><i>kcgijson</i> for the JSON output, and
					<b>-l</b><i>kcgi</i> for the input validation (and a library dependency for <b>-l</b><i>kcgijson</i>).
					The other libraries are dependencies on the former (<b>-l</b><i>sqlite3</i> and <b>-l</b><i>pthread</i>) and latter
					(<b>-l</b><i>z</i>).
					Obviously, I assume these are in the standard library path, though the third-party libraries will
					probably be in <b>-L</b><i>/usr/local/lib</i>, with headers in <b>-I</b><i>/usr/local/include</i>.
				</p>
			</section>
			<blockquote>
				<h2>
					% cc -static -o test main.c <a href="db.c.html">db.c</a> -lksql -lsqlite3 -lm -lpthread -lkcgijson -lkcgi -lz
				</h2>
				<div>
					Compile web application.
				</div>
			</blockquote>
			<section>
				<p>
					Applications not wishing to deal with input or output (for example, a management application or
					system daemon) should omit the <b>-j</b> and <b>-v</b> flags.
					These can then be compiled without static linking (omitting <b>-static</b>) and the non-SQLite related
					libraries.
				</p>
				<p>
					To create the initial database, use the following invocation.
					A feature I use a lot in <span class="nm">kwebapp</span> is to track differences in the database schema
					by using <a href="kwebapp-sqldiff.1.html">kwebapp-sqldiff(1)</a>.
					This allows me to double-check that upgrades to my database won't be incompatible.
					It also generates the correct invocations without having me fat-finger mistakes in the upgraded database.
				</p>
			</section>
			<blockquote>
				<h2>
					<div>
						% <a href="kwebapp-sql.1.html">kwebapp-sql</a>
						<a href="db.txt.html">db.txt</a> &gt;<a href="db.sql.html">db.sql</a>
					</div>
					<div>
						% <a href="kwebapp-sqldiff.1.html">kwebapp-sqldiff</a>
						<a href="db.old.txt.html">db.old.txt</a> <a href="db.txt.html">db.txt</a> &gt;<a href="db.update.sql.html">db.update.sql</a>
					</div>
					<div>
						% sqlite3 db.db &lt; <a href="db.sql.html">db.sql</a>
					</div>
				</h2>
				<div>
					Generate SQL schema and initialise database.
				</div>
			</blockquote>
			<section>
				<p>
					Notice that some object fields, like the <code>user</code> structure inside of the section, are not part of the SQL.
					Rather, they are generated within <a href="db.c.html">db.c</a> using the foreign keys.
					Also note that the SQL schema file is thoroughly documented.
					I suggest using <a href="https://kristaps.bsd.lv/sqliteconvert/">sqliteconvert</a> if you'd like to
					browse the SQL documentation for any non-trivial application.
				</p>
				<p>
					In general, I'll use <a href="kwebapp-sql.1.html">kwebapp-sql(1)</a> when first generating the database,
					and <a href="kwebapp-sqldiff.1.html">kwebapp-sqldiff(1)</a> when upgrading existing databases.
					There are times when the database changes radically, at which point I'll usually dump and manually update.
				</p>
				<p>
					The last part of the toolchain is to handle the output of <b>-j</b> in the browser itself.
					The <a href="kwebapp-javascript.1.html">kwebapp-javascript(1)</a> tool will also generate JavaScript files to
					assist in filling in data for your front-end web application code.
				</p>
			</section>
			<blockquote>
				<h2>
					% <a href="kwebapp-javascript.1.html">kwebapp-javascript</a>
					<a href="db.txt.html">db.txt</a> &gt;<a href="db.js.html">db.js</a>
				</h2>
				<div>
					Produce JavaScript classes to auto-fill DOM trees.
				</div>
			</blockquote>
			<section>
				<p>
					The JavaScript is useful when fetching information from your CGI script that was produced with <b>-j</b>.
					It has an easy interface for replacing certain tags in your HTML DOM tree with data.
					All of this is documented using <a href="https://usejsdoc.org">jsdoc</a> notation.
					For example, consider the following:
				</p>
				<article data-sblg-permlink="0" data-sblg-article="1"></article>
				<p>
					A JavaScript file may invoke <code>new user(res).fill(document.getElementById('foobar'))</code>, where
					<code>res</code> is the JSON object parsed from an AJAX call to the CGI script.
				</p>
			</section>
			<blockquote>
				<h2>
					% <a href="kwebapp-audit.1.html">kwebapp-audit</a>
					<a href="audit-example.txt.html">audit-example.txt</a> user
				</h2>
				<div>
					Audit role-based authentication access.
				</div>
			</blockquote>
			<section>
				<p>
					We can audit <a href="https://learnbchs.org/rbac.html">role-based access control</a> access with <a
						href="kwebapp-audit.1.html">kwebapp-audit(1)</a>, <a
						href="kwebapp-audit-json.1.html">kwebapp-audit-json(1)</a>, and <a
						href="kwebapp-audit-gv.1.html">kwebapp-audit-gv(1)</a>.
					By passing a role defined in the configuration to <a href="kwebapp-audit.1.html">kwebapp-audit(1)</a>,
					we're able to see the full availability of data and operations available to the role.
				</p>
				<p>
					In the example role-backed <a href="audit-example.txt.html">audit-example.txt</a> with roles
					<code>user</code> and <code>admin</code>, for example, we can fully audit for the <code>user</code> role
					as seen in the exemplar <a href="audit.html">audit.html</a>.
					We create with <a href="kwebapp-audit-json.1.html">kwebapp-audit-json(1)</a>.
					This visualisation breaks down access by structures (the foundational objects of <a
						href="kwebapp.5.html">kwebapp(5)</a>) and then grouped by operation.
				</p>
			</section>
		</article>
		<footer>
			Copyright &#xa9; 2017&#8211;2018, <a href="https://github.com/kristapsdz">Kristaps Dzonsons</a>
		</footer>
	</body>
</html>
