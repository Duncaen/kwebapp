.\"	$OpenBSD$
.\"
.\" Copyright (c) 2017 Kristaps Dzonsons <kristaps@bsd.lv>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate$
.Dt KWEBAPP-C-SOURCE 1
.Os
.Sh NAME
.Nm kwebapp-c-source
.Nd implement web application C API
.Sh SYNOPSIS
.Nm kwebapp-c-source
.Op Fl jsv
.Op Fl h Ar header[,header...]
.Op Fl I Ar djv
.Op Fl N Ar d
.Op Ar config
.Sh DESCRIPTION
The
.Nm
utility accepts
.Ar config
.Pq defaulting to standard input
and produces an implementation of the C API generated by
.Xr kwebapp-c-header 1 .
Its arguments are as follows:
.Bl -tag -width Ds
.It Fl h Ar header[,header...]
Include the set of comma-separated header files
.Ar header .
.It Fl I Ar djv
Indicate that the generated source must include headers for the
.Sx Database input
declarations
.Pq Ar d ,
the
.Sx JSON export
declarations
.Pq Ar j ,
and/or
.Sx Data validation
.Pq Ar v .
This allows multiple source files and a single header file.
It's safe to duplicate, such as specifying
.Fl I Ns Ar j
and
.Fl j .
.It Fl j
Output JSON output definitions as documented in
.Sx JSON export .
.It Fl v
Output data validator definitions as documented in
.Sx Data validation .
.It Fl N Ar d
Disable production of output, which may currently only be
.Ar b
to suppresses the
.Sx Database input
definitions.
.It Fl s
Use split-process mode for the database.
.El
.Pp
By default, the
.Sx Database input
and
.Sx Data structures
definitions are output with a header file of
.Pa db.h .
.Pp
All C code produced by
.Nm
conforms with the
.Xr style 9
manual of
.Ox .
.\" The following requests should be uncommented and used where appropriate.
.\" .Sh CONTEXT
.\" For section 9 functions only.
.\" .Sh RETURN VALUES
.\" For sections 2, 3, and 9 function return values only.
.\" .Sh ENVIRONMENT
.\" For sections 1, 6, 7, and 8 only.
.\" .Sh FILES
.Sh EXIT STATUS
.\" For sections 1, 6, and 8 only.
.Ex -std
.Sh EXAMPLES
In the simplest case, put all C sources and headers (for validation,
database routines, and JSON output) into one pair of files.
Let
.Pa foo.kwbp
be the configuration file.
.Bd -literal
kwebapp-c-header -jvs foo.kwbp > db.h
kwebapp-c-source -jvs foo.kwbp > db.c
.Ed
.Pp
Breaking up into two header and source files: one for basic database
functions, the other for JSON output.
.Bd -literal
kwebapp-c-header -s foo.kwbp > db.h
kwebapp-c-header -s -g JSON_H -j -Nbd foo.kwbp > json.h
kwebapp-c-source -s -h db.h > db.c
kwebapp-c-source -s -j -Nd -Idj -h db.h,json.h > json.c
.Ed
.Pp
In this more complicated snippet, the
.Pa json.h
file is created without structure or database information using
.Fl N , then
.Pa json.c
needs to include both database and JSON headers (in name,
.Fl h ,
and in the headers those stipulated in source, 
.Fl I )
also while inhibiting database routine creation with
.Fl N .
.\" .Sh DIAGNOSTICS
.\" For sections 1, 4, 6, 7, 8, and 9 printf/stderr messages only.
.\" .Sh ERRORS
.\" For sections 2, 3, 4, and 9 errno settings only.
.Sh SEE ALSO
.Xr kwebapp-c-header 1
.\" .Sh STANDARDS
.\" .Sh HISTORY
.\" .Sh AUTHORS
.\" .Sh CAVEATS
.\" .Sh BUGS
